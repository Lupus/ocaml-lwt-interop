<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module provides an executor for OCaml domains, integrating Rust async executors with the OCaml runtime."><title>ocaml_lwt_interop::domain_executor - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-6c3ea77c.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="ocaml_lwt_interop" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0 (05f9846f8 2025-03-31)" data-channel="1.86.0" data-search-js="search-581efc7a.js" data-settings-js="settings-6dad6058.js" ><script src="../../static.files/storage-3a5871a4.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-4d63596a.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../ocaml_lwt_interop/index.html">ocaml_<wbr>lwt_<wbr>interop</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module domain_<wbr>executor</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#usage" title="Usage">Usage</a></li><li><a href="#implementation-details" title="Implementation Details">Implementation Details</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate ocaml_<wbr>lwt_<wbr>interop</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">ocaml_lwt_interop</a></div><h1>Module <span>domain_executor</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/ocaml_lwt_interop/domain_executor.rs.html#1-505">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module provides an executor for OCaml domains, integrating Rust async
executors with the OCaml runtime.</p>
<h2 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h2>
<p>The <code>DomainExecutor</code> struct encapsulates an asynchronous executor designed
to be used within an OCaml domain.  It manages the execution of async tasks,
ensuring proper interaction with the OCaml runtime system.</p>
<p>The executor leverages the [<code>async_executor</code>] crate to run async tasks and
integrates with the [<code>tokio</code>] runtime for asynchronous I/O operations. It
provides mechanisms to spawn async tasks within the context of an OCaml
domain, ensuring that the OCaml runtime system’s domain lock is properly
managed during the execution of these tasks.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>The <code>DomainExecutor</code> can be used to spawn async tasks that need to interact
with the OCaml runtime.  It provides functions to enter the executor
context, spawn tasks, and ensure that the OCaml runtime lock is
appropriately acquired and released when necessary.</p>
<h2 id="implementation-details"><a class="doc-anchor" href="#implementation-details">§</a>Implementation Details</h2>
<p>The executor stack is managed using a thread-local variable, allowing the
executor context to be available within the current thread. The
<code>ExecutorGuard</code> struct ensures that the executor context is properly managed
during execution.</p>
<p>The <code>DomainExecutorDriver</code> struct drives the executor by polling its future
and ensures that tasks are executed in the context of the OCaml domain.</p>
<p>The module also provides functions to obtain the current Tokio runtime and
to execute code within the OCaml domain lock.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.DomainExecutor.html" title="struct ocaml_lwt_interop::domain_executor::DomainExecutor">Domain<wbr>Executor</a></dt><dd>An executor designed to run within an OCaml domain.</dd><dt><a class="struct" href="struct.DomainExecutorDriver.html" title="struct ocaml_lwt_interop::domain_executor::DomainExecutorDriver">Domain<wbr>Executor<wbr>Driver</a></dt><dd>A driver for the <code>DomainExecutor</code>, responsible for running the executor’s
tasks.</dd><dt><a class="struct" href="struct.ExecutorGuard.html" title="struct ocaml_lwt_interop::domain_executor::ExecutorGuard">Executor<wbr>Guard</a></dt><dd>A guard that manages the lifetime of an executor context within a scope.</dd><dt><a class="struct" href="struct.Handle.html" title="struct ocaml_lwt_interop::domain_executor::Handle">Handle</a></dt><dd>A handle to the OCaml domain executor, allowing tasks to be spawned.</dd><dt><a class="struct" href="struct.OcamlRuntimeGuard.html" title="struct ocaml_lwt_interop::domain_executor::OcamlRuntimeGuard">Ocaml<wbr>Runtime<wbr>Guard</a></dt><dd>A guard that provides access to the OCaml runtime handle within the current
thread.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.handle.html" title="fn ocaml_lwt_interop::domain_executor::handle">handle</a></dt><dd>Returns a handle to the current OCaml Domain executor.</dd><dt><a class="fn" href="fn.handle_from_runtime.html" title="fn ocaml_lwt_interop::domain_executor::handle_from_runtime">handle_<wbr>from_<wbr>runtime</a></dt><dd>Returns a handle to the executor obtained from the OCaml runtime.</dd><dt><a class="fn" href="fn.ocaml_runtime.html" title="fn ocaml_lwt_interop::domain_executor::ocaml_runtime">ocaml_<wbr>runtime</a></dt><dd>Obtains a guard to access the OCaml runtime handle.</dd><dt><a class="fn" href="fn.run_in_ocaml_domain.html" title="fn ocaml_lwt_interop::domain_executor::run_in_ocaml_domain">run_<wbr>in_<wbr>ocaml_<wbr>domain</a><sup title="unsafe function">⚠</sup></dt><dd>Runs a closure <code>f</code> within the OCaml domain, ensuring the OCaml runtime lock
is acquired.</dd><dt><a class="fn" href="fn.spawn.html" title="fn ocaml_lwt_interop::domain_executor::spawn">spawn</a></dt><dd>Spawns a future onto the current executor.</dd><dt><a class="fn" href="fn.spawn_lwt.html" title="fn ocaml_lwt_interop::domain_executor::spawn_lwt">spawn_<wbr>lwt</a></dt><dd>Spawns a future onto the executor obtained from the OCaml runtime and
returns an <a href="../promise/struct.Promise.html" title="struct ocaml_lwt_interop::promise::Promise"><code>crate::promise::Promise</code></a>.</dd><dt><a class="fn" href="fn.spawn_with_runtime.html" title="fn ocaml_lwt_interop::domain_executor::spawn_with_runtime">spawn_<wbr>with_<wbr>runtime</a></dt><dd>Spawns a future onto the executor obtained from the OCaml runtime.</dd><dt><a class="fn" href="fn.tokio_rt.html" title="fn ocaml_lwt_interop::domain_executor::tokio_rt">tokio_<wbr>rt</a></dt><dd>Returns a reference to the global Tokio runtime.</dd></dl></section></div></main></body></html>