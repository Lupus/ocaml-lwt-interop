<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module provides an implementation of a `Future` called `MlBoxFuture`, which bridges OCaml’s Lwt futures with Rust’s async ecosystem."><title>ocaml_lwt_interop::ml_box_future - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-916cea96.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="ocaml_lwt_interop" data-themes="" data-resource-suffix="" data-rustdoc-version="1.87.0 (17067e9ac 2025-05-09)" data-channel="1.87.0" data-search-js="search-e7298875.js" data-settings-js="settings-d72f25bb.js" ><script src="../../static.files/storage-82c7156e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-fb8c74a8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../ocaml_lwt_interop/index.html">ocaml_<wbr>lwt_<wbr>interop</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module ml_<wbr>box_<wbr>future</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#implementation-details" title="Implementation Details">Implementation Details</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate ocaml_<wbr>lwt_<wbr>interop</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">ocaml_lwt_interop</a></div><h1>Module <span>ml_box_future</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/ocaml_lwt_interop/ml_box_future.rs.html#1-142">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module provides an implementation of a <code>Future</code> called <code>MlBoxFuture</code>,
which bridges OCaml’s Lwt futures with Rust’s async ecosystem.</p>
<h2 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h2>
<p><code>MlBoxFuture</code> is designed to integrate OCaml’s Lwt futures with Rust’s
<code>async</code>/<code>await</code> syntax.
Due to limitations in passing Rust callbacks directly to OCaml functions
(e.g., it’s not possible to call <code>Lwt.on_any</code> from Rust and pass a Rust
closure), the approach is inverted:</p>
<ul>
<li>On the OCaml side, Lwt futures are wrapped into <code>MlBoxFuture</code> via C stubs.</li>
<li>OCaml registers callbacks on the Lwt future to resolve or reject the
<code>MlBoxFuture</code> when the Lwt future completes.</li>
<li>This allows the Rust <code>MlBoxFuture</code> to be driven by the OCaml runtime,
enabling Rust code to <code>await</code> on Lwt futures.</li>
</ul>
<h2 id="implementation-details"><a class="doc-anchor" href="#implementation-details">§</a>Implementation Details</h2>
<p>The <code>MlBoxFuture</code> is largely based on the timer future example from the Rust
<code>async</code> book:
<a href="https://rust-lang.github.io/async-book/02_execution/03_wakeups.html">Wakeups</a>.</p>
<p>It uses an <code>Arc&lt;Mutex&lt;SharedState&gt;&gt;</code> to manage shared state between the
future and the code that will resolve or reject it.
When the future is polled, it checks if the value is available. If not, it
stores the waker to be woken up later.
When the OCaml side resolves or rejects the future, it sets the value and
wakes up the waker, allowing the future to complete.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.MlBoxFuture.html" title="struct ocaml_lwt_interop::ml_box_future::MlBoxFuture">MlBox<wbr>Future</a></dt><dd>A future that represents a computation which will eventually produce an
<code>MlBox</code>.</dd></dl></section></div></main></body></html>